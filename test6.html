<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>é›™é­šåº§ç”·å‹ä¾†é›»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');

        :root {
            /* è§£æ±ºæ‰‹æ©Ÿ 100vh å•é¡Œ */
            --app-height: 100%;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(-45deg, #1a2a6c, #2a4858, #4a69bd, #0a3d62);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            /* æ‰‹æ©Ÿç«¯æµæš¢æ€§å„ªåŒ– */
            height: 100dvh;
            min-height: -webkit-fill-available;
            overflow: hidden;
            color: white;
            touch-action: manipulation;
            overscroll-behavior: none;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .blur-bg {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.1);
        }

        .incoming-call-anim {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden-state {
            display: none !important;
        }

        .wave {
            height: 5px;
            width: 5px;
            background: #2ecc71;
            margin: 0 2px;
            display: inline-block;
            animation: waveAnim 1s ease-in-out infinite;
        }
        @keyframes waveAnim {
            0%, 100% { height: 5px; }
            50% { height: 30px; }
        }

        .card-anim {
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-out {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }

        .option-btn {
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }
        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-between py-8 px-6 h-[100dvh]">

    <!-- 0. å•Ÿå‹•å°é¢ -->
    <div id="start-overlay" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-900/95 backdrop-blur-2xl">
        <div class="w-28 h-28 mb-8 rounded-full border-2 border-white/10 p-1 bg-white/5 flex items-center justify-center">
            <img src="é›™é­š.png" alt="å•Ÿå‹•é ­åƒ" class="w-full h-full object-cover rounded-full opacity-40 grayscale blur-[1px]">
        </div>
        <h2 class="text-2xl font-bold mb-10 tracking-[0.3em] text-white">æ˜¯èª°æ‰“çµ¦ä½ å‘¢ï¼Ÿ</h2>
        <button onclick="realInit()" class="px-12 py-4 bg-white/10 border border-white/30 rounded-full text-lg font-light tracking-widest shadow-2xl transition-all active:scale-95 backdrop-blur-md">
            é»æ“Šé€²å…¥
        </button>
        <p class="mt-6 text-xs opacity-40 tracking-tighter">é–‹å•Ÿè²éŸ³ä»¥è†è½æ˜Ÿéš›ç§èª</p>
    </div>

    <!-- 1. ä¾†é›»ç•«é¢ -->
    <div id="calling-screen" class="flex flex-col items-center justify-around w-full h-full max-w-md mx-auto py-4">
        <div class="text-center">
            <p class="text-lg opacity-80 tracking-widest mb-2">ä¾†é›»ä¸­...</p>
            <h1 class="text-4xl md:text-5xl font-bold tracking-tighter">é›™é­šåº§ç”·å‹</h1>
        </div>

        <div class="relative w-56 h-56 md:w-64 md:h-64 flex items-center justify-center">
            <div class="absolute inset-0 rounded-full border-4 border-white/30 incoming-call-anim"></div>
            <div class="w-48 h-48 md:w-56 md:h-56 rounded-full overflow-hidden border-2 border-white/50 bg-slate-800/50 shadow-2xl">
                <img src="é›™é­š.png" alt="é›™é­šåº§ç”·" class="w-full h-full object-cover object-top">
            </div>
        </div>

        <div class="w-full flex justify-around mb-6">
            <div onclick="rejectCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-red-500 rounded-full flex items-center justify-center mb-3 transition-all active:scale-110 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-base font-medium">æ‹’çµ•</span>
            </div>
            
            <div onclick="acceptCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-16 h-16 md:w-20 md:h-20 bg-green-500 rounded-full flex items-center justify-center mb-3 transition-all active:scale-110 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="rotate-[135deg]"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-base font-medium">æ¥è½</span>
            </div>
        </div>
    </div>

    <!-- 2. é€šè©±ä¸­ä»‹é¢ -->
    <div id="incall-screen" class="hidden-state flex flex-col items-center w-full h-full justify-between py-6">
        <div class="text-center z-10 pt-4">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">é›™é­šåº§ç”·å‹</h2>
            <div class="flex items-center justify-center">
                <div class="wave" style="animation-delay: 0.1s"></div>
                <div class="wave" style="animation-delay: 0.3s"></div>
                <div class="wave" style="animation-delay: 0.2s"></div>
                <div class="wave" style="animation-delay: 0.4s"></div>
                <span class="ml-3 font-mono text-lg" id="timer">00:00</span>
            </div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-40">
             <div class="h-full w-auto flex items-center justify-center overflow-hidden">
                <img src="é›™é­š.png" alt="é›™é­šåº§ç”·ç«‹ç¹ª" class="max-h-[80vh] w-auto object-contain">
             </div>
        </div>

        <div class="w-full max-w-lg px-2 mb-4 z-20">
            <div class="blur-bg rounded-[2rem] p-6 min-h-[140px] flex flex-col justify-center border border-white/20 shadow-2xl text-center">
                <p id="dialogue-box" class="text-xl leading-relaxed tracking-wider font-light"></p>
                <div id="blessing-btn" class="hidden-state mt-4 flex justify-center">
                    <button onclick="showBlessing()" class="bg-white/10 px-6 py-2 rounded-full text-sm border border-white/30 transition-all backdrop-blur-md active:bg-white/30">
                        æŸ¥çœ‹ä»–ç•™çµ¦ä½ çš„è©±
                    </button>
                </div>
            </div>
        </div>

        <div onclick="endCall()" class="w-16 h-16 md:w-20 md:h-20 bg-red-600 rounded-full flex items-center justify-center cursor-pointer active:scale-95 shadow-2xl z-20 mb-2">
             <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        </div>
    </div>

    <!-- 3. å åœé¸æ“‡ä»‹é¢ -->
    <div id="selection-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-4">
        <h2 class="text-2xl font-bold mb-4 text-center">è½å®Œä»–çš„å¿ƒæ„å¾Œ...</h2>
        <p class="text-base opacity-80 mb-8 text-center px-4">æ†‘ç›´è¦ºé»é¸ä¸€å€‹å°ˆå±¬æ–¼ä½ çš„å¹¸é‹å°å¼•ï¼š</p>
        
        <div class="grid grid-cols-1 gap-4 w-full px-2">
            <div onclick="selectFortune('tail')" class="option-btn blur-bg border border-white/20 rounded-2xl p-4 flex items-center cursor-pointer">
                <div class="w-14 h-14 bg-blue-400/30 rounded-full flex items-center justify-center text-2xl mr-4">ğŸ§œâ€â™‚ï¸</div>
                <div>
                    <h4 class="text-lg font-bold">é­šå°¾</h4>
                    <p class="text-xs opacity-60">é †è‘—ç›´è¦ºçš„æƒ…ç·’æµå‹•</p>
                </div>
            </div>

            <div onclick="selectFortune('ocean')" class="option-btn blur-bg border border-white/20 rounded-2xl p-4 flex items-center cursor-pointer">
                <div class="w-14 h-14 bg-cyan-400/30 rounded-full flex items-center justify-center text-2xl mr-4">ğŸŒŠ</div>
                <div>
                    <h4 class="text-lg font-bold">æµ·æ´‹</h4>
                    <p class="text-xs opacity-60">åŒ…å®¹ä¸€åˆ‡çš„å¹³éœåŠ›é‡</p>
                </div>
            </div>

            <div onclick="selectFortune('star')" class="option-btn blur-bg border border-white/20 rounded-2xl p-4 flex items-center cursor-pointer">
                <div class="w-14 h-14 bg-yellow-400/30 rounded-full flex items-center justify-center text-2xl mr-4">âœ¨</div>
                <div>
                    <h4 class="text-lg font-bold">æ˜Ÿæ˜Ÿ</h4>
                    <p class="text-xs opacity-60">æŒ‡å¼•å¤¢æƒ³çš„å¾®å…‰</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. å åœçµæœä»‹é¢ -->
    <div id="fortune-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-4">
        <div class="card-anim blur-bg rounded-[2rem] p-8 border border-white/30 shadow-2xl w-full text-center relative">
            <div class="absolute -top-10 left-1/2 -translate-x-1/2 w-20 h-20 rounded-full border-4 border-white/50 overflow-hidden shadow-xl bg-slate-900">
                <img src="é›™é­š.png" alt="é›™é­šåº§ç”·" class="w-full h-full object-cover object-top">
            </div>
            
            <h3 class="text-xl font-bold mt-10 mb-2">æœ¬æ—¥æ˜Ÿéˆå åœ</h3>
            <p id="fortune-type" class="text-blue-200 text-xs mb-6 tracking-widest uppercase font-mono"></p>
            
            <div class="space-y-6 text-left">
                <div>
                    <p class="text-[10px] opacity-50 mb-1 tracking-tighter">é‹å‹¢èƒ½é‡</p>
                    <div id="fortune-stars" class="flex text-yellow-400 text-base tracking-widest"></div>
                </div>
                
                <div>
                    <p class="text-[10px] opacity-50 mb-1 tracking-tighter">çµ¦ä½ çš„æŒ‡å¼•</p>
                    <p id="fortune-text" class="text-lg font-light leading-relaxed"></p>
                </div>
                
                <div class="grid grid-cols-2 gap-4 pt-4 border-t border-white/10">
                    <div>
                        <p class="text-[10px] opacity-50 mb-0.5 font-mono">LUCKY COLOR</p>
                        <p id="fortune-color" class="font-bold text-sm"></p>
                    </div>
                    <div>
                        <p class="text-[10px] opacity-50 mb-0.5 font-mono">LUCKY ITEM</p>
                        <p id="fortune-item" class="font-bold text-sm"></p>
                    </div>
                </div>
            </div>

            <button onclick="restartApp()" class="mt-8 w-full py-3 bg-white/10 hover:bg-white/20 rounded-xl border border-white/30 transition-all text-base font-medium active:scale-95">
                å†æ¬¡é€šè©±
            </button>
        </div>
        <p class="mt-8 text-[10px] opacity-30 tracking-widest uppercase">Â© Star Whispers Project</p>
    </div>

    <script>
        let timerInterval;
        let seconds = 0;
        let currentVoice = null;
        let isAudioInitialized = false;
        let isCallAccepted = false;

        // --- éŸ³æ•ˆåˆå§‹åŒ– ---
        const ringtone = new Audio('ringtone.mp3'); 
        ringtone.loop = true;

        const bgm = new Audio('bgm.mp3'); 
        bgm.loop = true;
        bgm.volume = 0.2;

        // é›™é­šåº§å°è©
        const dialogueData = [
            { text: "å–‚ï¼Ÿè½å¾—åˆ°å—ï¼Ÿ", vo: "pisces_1.mp3" },
            { text: "å‰›æ‰åœ¨æµ·é‚Šæ•£æ­¥ï¼Œçªç„¶å°±å¾ˆæƒ³è½è½ä½ çš„è²éŸ³...", vo: "pisces_2.mp3" },
            { text: "ç¸½è¦ºå¾—æœ‰äº›è©±ï¼Œç•¶é¢èªªæœƒå®³ç¾åˆ°èº²èµ·ä¾†ï¼Œæ‰€ä»¥æƒ³èªªæ‰“é›»è©±çµ¦ä½ ã€‚", vo: "pisces_3.mp3" },
            { text: "é‡è¦‹ä½ ä¹‹å¾Œï¼Œæˆ‘æ‰ç™¼ç¾ï¼ŒåŸä¾†é‚£äº›æµªæ¼«çš„å¹»æƒ³ï¼Œéƒ½ä¸åŠä½ çš„ä¸€è¨˜å¾®ç¬‘ã€‚", vo: "pisces_4.mp3" },
            { text: "ä½ å°±æ˜¯æˆ‘æœ€å¥½çš„ç¾å¯¦ã€‚é™ªæˆ‘ä¸€èµ·è™›åº¦å…‰é™°ï¼Œå¥½å—ï¼Ÿ", vo: "pisces_5.mp3" }
        ];

        // å•Ÿå‹•é‚è¼¯
        function realInit() {
            if (!isAudioInitialized) {
                const overlay = document.getElementById('start-overlay');
                overlay.classList.add('fade-out');
                setTimeout(() => overlay.style.display = 'none', 1000);

                ringtone.play().catch(e => console.log("éŸ¿éˆ´æ’­æ”¾å¤±æ•—:", e));
                isAudioInitialized = true;
            }
        }

        function acceptCall() {
            isCallAccepted = true; 
            ringtone.pause();
            ringtone.currentTime = 0;
            
            document.getElementById('calling-screen').classList.add('hidden-state');
            document.getElementById('incall-screen').classList.remove('hidden-state');
            
            bgm.play().catch(e => console.log("BGM æ’­æ”¾å¤±æ•—:", e));
            
            startTimer();
            playDialogueSequentially();
        }

        function startTimer() {
            seconds = 0;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                let min = Math.floor(seconds / 60).toString().padStart(2, '0');
                let sec = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${min}:${sec}`;
            }, 1000);
        }

        async function playDialogueSequentially() {
            const box = document.getElementById('dialogue-box');
            
            for (let i = 0; i < dialogueData.length; i++) {
                if (document.getElementById('incall-screen').classList.contains('hidden-state')) break;

                const item = dialogueData[i];
                box.innerHTML = `<span class="opacity-90">ã€Œ${item.text}ã€</span>`;
                
                currentVoice = new Audio(item.vo);
                
                await new Promise((resolve) => {
                    currentVoice.onended = resolve;
                    currentVoice.onerror = resolve;
                    currentVoice.play().catch(e => {
                        console.log(`æ’­æ”¾ ${item.vo} å¤±æ•—:`, e);
                        setTimeout(resolve, 2000);
                    });
                });

                await new Promise(r => setTimeout(r, 1200));
            }

            if (!document.getElementById('incall-screen').classList.contains('hidden-state')) {
                document.getElementById('blessing-btn').classList.remove('hidden-state');
            }
        }

        function showBlessing() {
            const box = document.getElementById('dialogue-box');
            box.innerHTML = `<span class="text-blue-100 font-normal leading-loose text-lg">ã€Œé€™å€‹æœˆï¼Œè¨˜å¾—çµ¦ä½ è‡ªå·±ä¸€é»åšå¤¢çš„ç©ºé–“ã€‚ä¸éœ€è¦äº‹äº‹éƒ½è¿½æ±‚æ•ˆç‡ï¼Œä½ ç¾åœ¨åŠªåŠ›çš„æ¨£å­å°±å·²ç¶“é–ƒé–ƒç™¼å…‰äº†ã€‚æˆ‘æœƒä¸€ç›´åœ¨ä½ èº«é‚Šï¼Œç•¶ä½ æœ€æº«æŸ”çš„æ¸¯å£ã€‚ã€</span>`;
            document.getElementById('blessing-btn').classList.add('hidden-state');
        }

        function endCall() {
            clearInterval(timerInterval);
            ringtone.pause();
            if (currentVoice) {
                currentVoice.pause();
                currentVoice.currentTime = 0;
            }
            bgm.pause();
            bgm.currentTime = 0;

            document.getElementById('incall-screen').classList.add('hidden-state');
            document.getElementById('selection-screen').classList.remove('hidden-state');
        }

        const fortuneData = {
            tail: { type: 'Fish Tail - æƒ…ç·’æµå‹•', stars: 'â˜…â˜…â˜…â˜…â˜†', text: 'ä»Šå¤©çš„ä½ é©åˆé †è‘—æ„Ÿè¦ºèµ°ã€‚ä¸è¦å£“æŠ‘å¿ƒä¸­çš„å°å°æ¸´æœ›ï¼Œç•¶ä½ å‹‡æ•¢æ¸¸å‘å¤§æµ·ï¼Œä½ æœƒç™¼ç¾é©šå–œå°±åœ¨å‰æ–¹ã€‚', color: 'çŠç‘šç²‰', item: 'æ‰‹ä½œé£¾å“' },
            ocean: { type: 'Ocean - å¹³éœåŠ›é‡', stars: 'â˜…â˜…â˜…â˜…â˜…', text: 'åƒå¤§æµ·ä¸€æ¨£åŒ…å®¹æ‰€æœ‰æƒ…ç·’ã€‚ç•¶ä½ å­¸æœƒå¹³éœåœ°çœ‹å¾…é‚£äº›ç…©æƒ±ï¼Œé™½å…‰è‡ªç„¶å°±æœƒé€é€²æ·±æµ·ï¼Œç…§äº®ä½ çš„å¿ƒã€‚', color: 'æ·±æµ·è—', item: 'é¦™æ°›è Ÿç‡­' },
            star: { type: 'Star - å¤¢æƒ³æŒ‡å¼•', stars: 'â˜…â˜…â˜…â˜…â˜†', text: 'ä¸è¦å®³æ€•åšå¤¢ï¼Œä½ çš„å¤¢æƒ³æ­£åƒåŒ—æ¥µæ˜Ÿä¸€æ¨£æŒ‡å¼•è‘—ä½ ã€‚åªè¦å …æŒä½ æ‰€ç›¸ä¿¡çš„ï¼Œæ•´ç‰‡æ˜Ÿç©ºéƒ½æœƒç‚ºä½ é–ƒè€€ã€‚', color: 'æ˜Ÿå…‰éŠ€', item: 'è¨˜äº‹æœ¬' }
        };

        function selectFortune(choice) {
            const data = fortuneData[choice];
            document.getElementById('fortune-type').innerText = data.type;
            document.getElementById('fortune-stars').innerText = data.stars;
            document.getElementById('fortune-text').innerText = data.text;
            document.getElementById('fortune-color').innerText = data.color;
            document.getElementById('fortune-item').innerText = data.item;

            document.getElementById('selection-screen').classList.add('hidden-state');
            document.getElementById('fortune-screen').classList.remove('hidden-state');
        }

        function restartApp() {
            location.reload();
        }

        function rejectCall() {
            ringtone.pause();
            const status = document.querySelector('#calling-screen p');
            status.innerText = "é€šè©±å·²æ‹’çµ•";
            setTimeout(() => { location.reload(); }, 1500);
        }
    </script>
</body>
</html>
