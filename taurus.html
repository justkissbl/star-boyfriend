<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘ç‰›åº§ç”·å‹ä¾†é›»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(-45deg, #1e3a1e, #3a5a40, #588157, #a3b18a);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            overflow: hidden;
            color: white;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .blur-bg {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.1);
        }

        .incoming-call-anim {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden-state {
            display: none !important;
        }

        .wave {
            height: 5px;
            width: 5px;
            background: #e67e22;
            margin: 0 2px;
            display: inline-block;
            animation: waveAnim 1s ease-in-out infinite;
        }
        @keyframes waveAnim {
            0%, 100% { height: 5px; }
            50% { height: 30px; }
        }

        .card-anim {
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-out {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }

        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-between py-10 px-6 h-screen">

    <!-- 0. å•Ÿå‹•å°é¢ -->
    <div id="start-overlay" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-slate-900/95 backdrop-blur-2xl">
        <div class="w-32 h-32 mb-8 rounded-full border-2 border-white/10 p-1 bg-white/5 flex items-center justify-center">
            <img src="é‡‘ç‰›.png" alt="å•Ÿå‹•é ­åƒ" class="w-full h-full object-cover rounded-full opacity-40 grayscale blur-[2px]">
        </div>
        <h2 class="text-3xl font-bold mb-10 tracking-[0.3em] text-white">æ˜¯èª°æ‰“çµ¦ä½ å‘¢ï¼Ÿ</h2>
        <button onclick="realInit()" class="px-12 py-4 bg-white/10 hover:bg-white/20 border border-white/30 rounded-full text-lg font-light tracking-widest shadow-2xl transition-all hover:scale-105 active:scale-95 backdrop-blur-md">
            é»æ“Šé€²å…¥
        </button>
        <p class="mt-6 text-xs opacity-40 tracking-tighter">é–‹å•Ÿè²éŸ³ä»¥è†è½æ˜Ÿéš›ç§èª</p>
    </div>

    <!-- 1. ä¾†é›»ç•«é¢ -->
    <div id="calling-screen" class="flex flex-col items-center justify-around w-full h-full max-w-md mx-auto">
        <div class="text-center">
            <p class="text-xl opacity-80 tracking-widest mb-2">ä¾†é›»ä¸­...</p>
            <h1 class="text-5xl font-bold tracking-tighter">é‡‘ç‰›åº§ç”·å‹</h1>
        </div>

        <div class="relative w-64 h-64 flex items-center justify-center">
            <div class="absolute inset-0 rounded-full border-4 border-white/30 incoming-call-anim"></div>
            <div class="w-56 h-56 rounded-full overflow-hidden border-2 border-white/50 bg-slate-800/50 shadow-2xl">
                <img src="é‡‘ç‰›.png" alt="é‡‘ç‰›åº§ç”·" class="w-full h-full object-cover object-top">
            </div>
        </div>

        <div class="w-full flex justify-around mb-10">
            <div onclick="rejectCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mb-3 group-hover:bg-red-600 transition-all shadow-lg hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-lg font-medium">æ‹’çµ•</span>
            </div>
            
            <div onclick="acceptCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-3 group-hover:bg-green-600 transition-all shadow-lg hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="rotate-[135deg]"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-lg font-medium">æ¥è½</span>
            </div>
        </div>
    </div>

    <!-- 2. é€šè©±ä¸­ä»‹é¢ -->
    <div id="incall-screen" class="hidden-state flex flex-col items-center w-full h-full justify-between py-10">
        <div class="text-center z-10">
            <h2 class="text-3xl font-bold mb-2">é‡‘ç‰›åº§ç”·å‹</h2>
            <div class="flex items-center justify-center">
                <div class="wave" style="animation-delay: 0.1s"></div>
                <div class="wave" style="animation-delay: 0.3s"></div>
                <div class="wave" style="animation-delay: 0.2s"></div>
                <div class="wave" style="animation-delay: 0.4s"></div>
                <span class="ml-3 font-mono text-xl" id="timer">00:00</span>
            </div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-40">
             <div class="h-screen w-auto flex items-center justify-center">
                <img src="é‡‘ç‰›.png" alt="é‡‘ç‰›åº§ç”·ç«‹ç¹ª" class="max-h-[85vh] w-auto object-contain">
             </div>
        </div>

        <div class="w-full max-w-lg px-6 mb-8 z-20">
            <div class="blur-bg rounded-3xl p-8 min-h-[160px] flex flex-col justify-center border border-white/30 shadow-2xl text-center">
                <p id="dialogue-box" class="text-2xl leading-relaxed tracking-wider font-light"></p>
                <div id="blessing-btn" class="hidden-state mt-6 flex justify-center">
                    <button onclick="showBlessing()" class="bg-white/20 hover:bg-white/30 px-8 py-3 rounded-full text-base border border-white/40 transition-all backdrop-blur-md">
                        æŸ¥çœ‹ä»–ç•™çµ¦ä½ çš„è©±
                    </button>
                </div>
            </div>
        </div>

        <div onclick="endCall()" class="w-20 h-20 bg-red-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-red-700 transition-all shadow-2xl z-20 mb-4 hover:scale-105">
             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        </div>
    </div>

    <!-- 3. å åœé¸æ“‡ä»‹é¢ -->
    <div id="selection-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-6">
        <h2 class="text-3xl font-bold mb-4 text-center">è½å®Œä»–çš„å¿ƒæ„å¾Œ...</h2>
        <p class="text-lg opacity-80 mb-10 text-center">æ†‘ç›´è¦ºé»é¸ä¸€å€‹å°ˆå±¬æ–¼ä½ çš„å¹¸é‹å°å¼•ï¼š</p>
        
        <div class="grid grid-cols-1 gap-6 w-full">
            <div onclick="selectFortune('wood')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-green-400/30 rounded-full flex items-center justify-center text-3xl mr-6">ğŸŒ³</div>
                <div>
                    <h4 class="text-xl font-bold">ç¿ æœ¨</h4>
                    <p class="text-sm opacity-60">åœŸè±¡åŠ›é‡ï¼Œç©©å®šçš„èŒèŠ½</p>
                </div>
            </div>

            <div onclick="selectFortune('coin')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-yellow-400/30 rounded-full flex items-center justify-center text-3xl mr-6">ğŸª™</div>
                <div>
                    <h4 class="text-xl font-bold">é‡‘å¹£</h4>
                    <p class="text-sm opacity-60">è±ç››èƒ½é‡ï¼Œå¯¦è³ªçš„æ”¶ç©«</p>
                </div>
            </div>

            <div onclick="selectFortune('hearth')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-orange-400/30 rounded-full flex items-center justify-center text-3xl mr-6">ğŸ”¥</div>
                <div>
                    <h4 class="text-xl font-bold">çˆç«</h4>
                    <p class="text-sm opacity-60">æº«æš–æŒ‡å¼•ï¼Œç”Ÿæ´»çš„ç´”ç²¹</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. å åœçµæœä»‹é¢ -->
    <div id="fortune-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-4">
        <div class="card-anim blur-bg rounded-[2.5rem] p-10 border border-white/40 shadow-2xl w-full text-center relative">
            <div class="absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 rounded-full border-4 border-white/50 overflow-hidden shadow-xl bg-slate-900">
                <img src="é‡‘ç‰›.png" alt="é‡‘ç‰›åº§ç”·" class="w-full h-full object-cover object-top">
            </div>
            
            <h3 class="text-2xl font-bold mt-10 mb-2">æœ¬æ—¥æ˜Ÿéˆå åœ</h3>
            <p id="fortune-type" class="text-yellow-200 text-sm mb-8 tracking-widest uppercase"></p>
            
            <div class="space-y-8 text-left">
                <div>
                    <p class="text-xs opacity-50 mb-2 tracking-tighter">é‹å‹¢èƒ½é‡</p>
                    <div id="fortune-stars" class="flex text-yellow-400 text-xl tracking-widest"></div>
                </div>
                
                <div>
                    <p class="text-xs opacity-50 mb-2 tracking-tighter">çµ¦ä½ çš„æŒ‡å¼•</p>
                    <p id="fortune-text" class="text-xl font-light leading-relaxed"></p>
                </div>
                
                <div class="grid grid-cols-2 gap-6 pt-6 border-t border-white/10">
                    <div>
                        <p class="text-xs opacity-50 mb-1">å¹¸é‹è‰²</p>
                        <p id="fortune-color" class="font-bold text-lg"></p>
                    </div>
                    <div>
                        <p class="text-xs opacity-50 mb-1">å¹¸é‹å°ç‰©</p>
                        <p id="fortune-item" class="font-bold text-lg"></p>
                    </div>
                </div>
            </div>

            <button onclick="restartApp()" class="mt-12 w-full py-4 bg-white/10 hover:bg-white/20 rounded-2xl border border-white/30 transition-all text-lg font-medium">
                å†æ¬¡é€šè©±
            </button>
        </div>
        <p class="mt-10 text-xs opacity-30 tracking-widest uppercase">Â© Star Whispers Project</p>
    </div>

    <script>
        let timerInterval;
        let seconds = 0;
        let currentVoice = null;
        let isAudioInitialized = false;
        let isCallAccepted = false;

        const ringtone = new Audio('ringtone.mp3'); 
        ringtone.loop = true;

        const bgm = new Audio('bgm.mp3'); 
        bgm.loop = true;
        bgm.volume = 0.2;

        const dialogueData = [
            { text: "å–‚ï¼Ÿæ˜¯æˆ‘ã€‚æ²’åµåˆ°ä½ ä¼‘æ¯å§ï¼Ÿ", vo: "taurus_1.mp3" },
            { text: "å‰›å‰›è·¯éé‚£é–“ä½ å¾ˆå–œæ­¡çš„ç”œé»åº—ï¼Œæ’éšŠæ’å¥½ä¹…ï¼Œçµ‚æ–¼è²·åˆ°äº†ã€‚", vo: "taurus_2.mp3" },
            { text: "æƒ³èªª...æ—¢ç„¶éƒ½è²·äº†ï¼Œå°±é †ä¾¿è½è½ä½ çš„è²éŸ³ï¼Œå•ä½ ä»€éº¼æ™‚å€™æœ‰ç©ºã€‚", vo: "taurus_3.mp3" },
            { text: "å…¶å¯¦æ¯”èµ·é©šå–œï¼Œæˆ‘æ›´å–œæ­¡é€™æ¨£è¸å¯¦çš„æ„Ÿè¦ºã€‚åªè¦è½‰éé ­ï¼Œä½ éƒ½åœ¨èº«é‚Šã€‚", vo: "taurus_4.mp3" },
            { text: "ç­‰ä¸‹è¦‹é¢å§ï¼Œæˆ‘æŠŠæº«æš–å’Œç”œé»éƒ½å¸¶çµ¦ä½ ã€‚", vo: "taurus_5.mp3" }
        ];

        const blessingText = "ã€Œé€™å€‹æœˆï¼Œè¨˜å¾—å¤šçŠ’è³è¾›å‹çš„è‡ªå·±ã€‚è²·ä¸€ä»¶è³ªæ„Ÿå¥½çš„è¡£æœï¼Œæˆ–æ˜¯åƒä¸€é “åš®å¾€å·²ä¹…çš„å¤§é¤ã€‚ç©©ç´®ç©©æ‰“çš„ä½ ï¼Œå€¼å¾—æ‰€æœ‰æœ€å¯¦åœ¨çš„ç¾å¥½ã€‚æˆ‘æœƒä¸€ç›´åœ¨é€™è£¡ï¼Œé™ªä½ æ…¢æ…¢èµ°ã€‚ã€";

        const fortuneData = {
            wood: {
                type: 'Emerald - ç©©å®šèŒèŠ½',
                stars: 'â˜…â˜…â˜…â˜…â˜…',
                text: 'é€™æ˜¯ä¸€å€‹é©åˆæ·±è€•çš„æ™‚æœŸã€‚ä¸è¦æ€¥è‘—çœ‹åˆ°çµæœï¼Œç¾åœ¨ä»˜å‡ºçš„åŠªåŠ›å°±åƒæ‰æ ¹ä¸€æ¨£ï¼Œæœªä¾†æœƒé•·æˆè®“ä½ é®é¢¨é¿é›¨çš„å¤§æ¨¹ã€‚',
                color: 'æ£®æ—ç¶ ',
                item: 'å°ç›†æ ½'
            },
            coin: {
                type: 'Gold Coin - è±ç››æ”¶ç©«',
                stars: 'â˜…â˜…â˜…â˜…â˜†',
                text: 'è²¡å¯Œèˆ‡åƒ¹å€¼çš„èƒ½é‡æ­£åœ¨å‘ä½ é æ”ã€‚ä¿æŒä½ å°å“è³ªçš„å …æŒï¼Œé€™ç¨®ä¸å¦¥å”çš„æ…‹åº¦æœƒç‚ºä½ å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„å¯¦è³ªæ”¶ç©«ã€‚',
                color: 'ç¥ç€é‡‘',
                item: 'çš®é©é›¶éŒ¢åŒ…'
            },
            hearth: {
                type: 'Hearth - ç”Ÿæ´»ç´”ç²¹',
                stars: 'â˜…â˜…â˜…â˜…â˜…',
                text: 'å›æ­¸ç”Ÿæ´»çš„æœ¬è³ªå§ã€‚ä¸ç®¡æ˜¯å±…å®¶ä½ˆç½®é‚„æ˜¯è¦ªè‡ªä¸‹å»šï¼Œç•¶ä½ æŠŠå°ˆæ³¨åŠ›æ”¾å›æ—¥å¸¸çš„å°äº‹ï¼Œä½ æœƒç™¼ç¾å…§å¿ƒæ„Ÿåˆ°ç„¡æ¯”å……å¯¦ã€‚',
                color: 'æº«æš–ç±³è‰²',
                item: 'é¦™æ°›å™´éœ§'
            }
        };

        function realInit() {
            if (!isAudioInitialized) {
                const overlay = document.getElementById('start-overlay');
                overlay.classList.add('fade-out');
                setTimeout(() => overlay.style.display = 'none', 1000);

                ringtone.play().catch(e => console.log("éŸ¿éˆ´æ’­æ”¾å¤±æ•—:", e));
                isAudioInitialized = true;
            }
        }

        function acceptCall() {
            isCallAccepted = true; 
            ringtone.pause();
            ringtone.currentTime = 0;
            
            document.getElementById('calling-screen').classList.add('hidden-state');
            document.getElementById('incall-screen').classList.remove('hidden-state');
            
            bgm.play().catch(e => console.log("BGM æ’­æ”¾å¤±æ•—:", e));
            
            startTimer();
            playDialogueSequentially();
        }

        function startTimer() {
            seconds = 0;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                let min = Math.floor(seconds / 60).toString().padStart(2, '0');
                let sec = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${min}:${sec}`;
            }, 1000);
        }

        async function playDialogueSequentially() {
            const box = document.getElementById('dialogue-box');
            
            for (let i = 0; i < dialogueData.length; i++) {
                if (document.getElementById('incall-screen').classList.contains('hidden-state')) break;

                const item = dialogueData[i];
                box.innerHTML = `<span class="opacity-90">ã€Œ${item.text}ã€</span>`;
                
                currentVoice = new Audio(item.vo);
                
                await new Promise((resolve) => {
                    currentVoice.onended = resolve;
                    currentVoice.onerror = resolve;
                    currentVoice.play().catch(e => {
                        console.log(`æ’­æ”¾ ${item.vo} å¤±æ•—:`, e);
                        setTimeout(resolve, 2000);
                    });
                });

                await new Promise(r => setTimeout(r, 1200));
            }

            if (!document.getElementById('incall-screen').classList.contains('hidden-state')) {
                document.getElementById('blessing-btn').classList.remove('hidden-state');
            }
        }

        function showBlessing() {
            const box = document.getElementById('dialogue-box');
            box.innerHTML = `<span class="text-orange-100 font-normal leading-loose">${blessingText}</span>`;
            document.getElementById('blessing-btn').classList.add('hidden-state');
        }

        function endCall() {
            clearInterval(timerInterval);
            ringtone.pause();
            if (currentVoice) {
                currentVoice.pause();
                currentVoice.currentTime = 0;
            }
            bgm.pause();
            bgm.currentTime = 0;

            document.getElementById('incall-screen').classList.add('hidden-state');
            document.getElementById('selection-screen').classList.remove('hidden-state');
        }

        function selectFortune(choice) {
            const data = fortuneData[choice];
            document.getElementById('fortune-type').innerText = data.type;
            document.getElementById('fortune-stars').innerText = data.stars;
            document.getElementById('fortune-text').innerText = data.text;
            document.getElementById('fortune-color').innerText = data.color;
            document.getElementById('fortune-item').innerText = data.item;

            document.getElementById('selection-screen').classList.add('hidden-state');
            document.getElementById('fortune-screen').classList.remove('hidden-state');
        }

        function restartApp() {
            location.reload();
        }

        function rejectCall() {
            ringtone.pause();
            const status = document.querySelector('#calling-screen p');
            status.innerText = "é€šè©±å·²æ‹’çµ•";
            setTimeout(() => { location.reload(); }, 1500);
        }
    </script>
</body>
</html>
