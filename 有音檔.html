<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™é­šåº§ç”·å‹ä¾†é›»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(-45deg, #1a2a6c, #2a4858, #4a69bd, #0a3d62);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            overflow: hidden;
            color: white;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .blur-bg {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.1);
        }

        .incoming-call-anim {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .hidden-state {
            display: none !important;
        }

        .wave {
            height: 5px;
            width: 5px;
            background: #2ecc71;
            margin: 0 2px;
            display: inline-block;
            animation: waveAnim 1s ease-in-out infinite;
        }
        @keyframes waveAnim {
            0%, 100% { height: 5px; }
            50% { height: 30px; }
        }

        .card-anim {
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-between py-10 px-6 h-screen">

    <!-- 1. ä¾†é›»ç•«é¢ -->
    <div id="calling-screen" class="flex flex-col items-center justify-around w-full h-full max-w-md mx-auto">
        <div class="text-center">
            <p class="text-xl opacity-80 tracking-widest mb-2">ä¾†é›»ä¸­...</p>
            <h1 class="text-5xl font-bold tracking-tighter">é›™é­šåº§ç”·å‹</h1>
        </div>

        <div class="relative w-64 h-64 flex items-center justify-center">
            <div class="absolute inset-0 rounded-full border-4 border-white/30 incoming-call-anim"></div>
            <div class="w-56 h-56 rounded-full overflow-hidden border-2 border-white/50 bg-slate-800/50 shadow-2xl">
                <img src="é›™é­š.PNG" alt="é›™é­šåº§ç”·" class="w-full h-full object-cover object-top">
            </div>
        </div>

        <div class="w-full flex justify-around mb-10">
            <div onclick="rejectCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-20 h-20 bg-red-500 rounded-full flex items-center justify-center mb-3 group-hover:bg-red-600 transition-all shadow-lg hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-lg font-medium">æ‹’çµ•</span>
            </div>
            
            <div onclick="acceptCall()" class="flex flex-col items-center cursor-pointer group">
                <div class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mb-3 group-hover:bg-green-600 transition-all shadow-lg hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="rotate-[135deg]"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <span class="text-lg font-medium">æ¥è½</span>
            </div>
        </div>
    </div>

    <!-- 2. é€šè©±ä¸­ä»‹é¢ -->
    <div id="incall-screen" class="hidden-state flex flex-col items-center w-full h-full justify-between py-10">
        <div class="text-center z-10">
            <h2 class="text-3xl font-bold mb-2">é›™é­šåº§ç”·å‹</h2>
            <div class="flex items-center justify-center">
                <div class="wave" style="animation-delay: 0.1s"></div>
                <div class="wave" style="animation-delay: 0.3s"></div>
                <div class="wave" style="animation-delay: 0.2s"></div>
                <div class="wave" style="animation-delay: 0.4s"></div>
                <span class="ml-3 font-mono text-xl" id="timer">00:00</span>
            </div>
        </div>

        <div class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-40">
             <div class="h-screen w-auto flex items-center justify-center">
                <img src="é›™é­š.PNG" alt="é›™é­šåº§ç”·ç«‹ç¹ª" class="max-h-[85vh] w-auto object-contain">
             </div>
        </div>

        <div class="w-full max-w-lg px-6 mb-8 z-20">
            <div class="blur-bg rounded-3xl p-8 min-h-[160px] flex flex-col justify-center border border-white/30 shadow-2xl text-center">
                <p id="dialogue-box" class="text-2xl leading-relaxed tracking-wider font-light"></p>
                <div id="blessing-btn" class="hidden-state mt-6 flex justify-center">
                    <button onclick="showBlessing()" class="bg-white/20 hover:bg-white/30 px-8 py-3 rounded-full text-base border border-white/40 transition-all backdrop-blur-md">
                        æŸ¥çœ‹ä»–ç•™çµ¦ä½ çš„è©±
                    </button>
                </div>
            </div>
        </div>

        <div onclick="endCall()" class="w-20 h-20 bg-red-600 rounded-full flex items-center justify-center cursor-pointer hover:bg-red-700 transition-all shadow-2xl z-20 mb-4 hover:scale-105">
             <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l2.28-2.28a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        </div>
    </div>

    <!-- 3. å åœé¸æ“‡ä»‹é¢ -->
    <div id="selection-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-6">
        <h2 class="text-3xl font-bold mb-4 text-center">è½å®Œä»–çš„å¿ƒæ„å¾Œ...</h2>
        <p class="text-lg opacity-80 mb-10 text-center">æ†‘ç›´è¦ºé»é¸ä¸€å€‹å°ˆå±¬æ–¼ä½ çš„å¹¸é‹å°å¼•ï¼š</p>
        
        <div class="grid grid-cols-1 gap-6 w-full">
            <div onclick="selectFortune('tail')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-blue-400/30 rounded-full flex items-center justify-center text-3xl mr-6">ğŸ§œâ€â™‚ï¸</div>
                <div>
                    <h4 class="text-xl font-bold">é­šå°¾</h4>
                    <p class="text-sm opacity-60">é †è‘—ç›´è¦ºçš„æƒ…ç·’æµå‹•</p>
                </div>
            </div>

            <div onclick="selectFortune('ocean')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-cyan-400/30 rounded-full flex items-center justify-center text-3xl mr-6">ğŸŒŠ</div>
                <div>
                    <h4 class="text-xl font-bold">æµ·æ´‹</h4>
                    <p class="text-sm opacity-60">åŒ…å®¹ä¸€åˆ‡çš„å¹³éœåŠ›é‡</p>
                </div>
            </div>

            <div onclick="selectFortune('star')" class="option-btn blur-bg border border-white/30 rounded-2xl p-6 flex items-center cursor-pointer">
                <div class="w-16 h-16 bg-yellow-400/30 rounded-full flex items-center justify-center text-3xl mr-6">âœ¨</div>
                <div>
                    <h4 class="text-xl font-bold">æ˜Ÿæ˜Ÿ</h4>
                    <p class="text-sm opacity-60">æŒ‡å¼•å¤¢æƒ³çš„å¾®å…‰</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. å åœçµæœä»‹é¢ -->
    <div id="fortune-screen" class="hidden-state flex flex-col items-center justify-center w-full h-full max-w-md mx-auto px-4">
        <div class="card-anim blur-bg rounded-[2.5rem] p-10 border border-white/40 shadow-2xl w-full text-center relative">
            <div class="absolute -top-12 left-1/2 -translate-x-1/2 w-24 h-24 rounded-full border-4 border-white/50 overflow-hidden shadow-xl bg-slate-900">
                <img src="é›™é­š.PNG" alt="é›™é­šåº§ç”·" class="w-full h-full object-cover object-top">
            </div>
            
            <h3 class="text-2xl font-bold mt-10 mb-2">æœ¬æ—¥æ˜Ÿéˆå åœ</h3>
            <p id="fortune-type" class="text-blue-200 text-sm mb-8 tracking-widest uppercase"></p>
            
            <div class="space-y-8 text-left">
                <div>
                    <p class="text-xs opacity-50 mb-2 tracking-tighter">é‹å‹¢èƒ½é‡</p>
                    <div id="fortune-stars" class="flex text-yellow-400 text-xl tracking-widest"></div>
                </div>
                
                <div>
                    <p class="text-xs opacity-50 mb-2 tracking-tighter">çµ¦ä½ çš„æŒ‡å¼•</p>
                    <p id="fortune-text" class="text-xl font-light leading-relaxed"></p>
                </div>
                
                <div class="grid grid-cols-2 gap-6 pt-6 border-t border-white/10">
                    <div>
                        <p class="text-xs opacity-50 mb-1">å¹¸é‹è‰²</p>
                        <p id="fortune-color" class="font-bold text-lg"></p>
                    </div>
                    <div>
                        <p class="text-xs opacity-50 mb-1">å¹¸é‹å°ç‰©</p>
                        <p id="fortune-item" class="font-bold text-lg"></p>
                    </div>
                </div>
            </div>

            <button onclick="restartApp()" class="mt-12 w-full py-4 bg-white/10 hover:bg-white/20 rounded-2xl border border-white/30 transition-all text-lg font-medium">
                å†æ¬¡é€šè©±
            </button>
        </div>
        <p class="mt-10 text-xs opacity-30 tracking-widest uppercase">Â© Star Whispers Project</p>
    </div>

    <script>
        let timerInterval;
        let seconds = 0;
        let currentVoice = null; // è¿½è¹¤ç›®å‰æ’­æ”¾ä¸­çš„åˆ†æ®µèªéŸ³

        // --- èƒŒæ™¯éŸ³æ¨‚åˆå§‹åŒ– ---
        const bgm = new Audio('bgm.mp3');
        bgm.loop = true;
        bgm.volume = 0.25;

        // --- åˆ†æ®µå°è©èˆ‡å°æ‡‰èªéŸ³è·¯å¾‘ ---
        const dialogueData = [
            { text: "å–‚ï¼Ÿè½å¾—åˆ°å—ï¼Ÿ", vo: "pisces_1.mp3" },
            { text: "å‰›æ‰åœ¨æµ·é‚Šæ•£æ­¥ï¼Œçªç„¶å°±å¾ˆæƒ³è½è½ä½ çš„è²éŸ³...", vo: "pisces_2.mp3" },
            { text: "ç¸½è¦ºå¾—æœ‰äº›è©±ï¼Œç•¶é¢èªªæœƒå®³ç¾åˆ°èº²èµ·ä¾†ï¼Œæ‰€ä»¥æƒ³èªªæ‰“é›»è©±çµ¦ä½ ã€‚", vo: "pisces_3.mp3" },
            { text: "é‡è¦‹ä½ ä¹‹å¾Œï¼Œæˆ‘æ‰ç™¼ç¾ï¼ŒåŸä¾†é‚£äº›æµªæ¼«çš„å¹»æƒ³ï¼Œéƒ½ä¸åŠä½ çš„ä¸€è¨˜å¾®ç¬‘ã€‚", vo: "pisces_4.mp3" },
            { text: "ä½ å°±æ˜¯æˆ‘æœ€å¥½çš„ç¾å¯¦ã€‚é™ªæˆ‘ä¸€èµ·è™›åº¦å…‰é™°ï¼Œå¥½å—ï¼Ÿ", vo: "pisces_5.mp3" }
        ];

        const blessing = "ã€Œé€™å€‹æœˆï¼Œè¨˜å¾—çµ¦ä½ è‡ªå·±ä¸€é»åšå¤¢çš„ç©ºé–“ã€‚ä¸éœ€è¦äº‹äº‹éƒ½è¿½æ±‚æ•ˆç‡ï¼Œä½ ç¾åœ¨åŠªåŠ›çš„æ¨£å­å°±å·²ç¶“é–ƒé–ƒç™¼å…‰äº†ã€‚æˆ‘æœƒä¸€ç›´åœ¨ä½ èº«é‚Šï¼Œç•¶ä½ æœ€æº«æŸ”çš„æ¸¯å£ã€‚ã€";

        const fortuneData = {
            tail: {
                type: 'Fish Tail - æƒ…ç·’æµå‹•',
                stars: 'â˜…â˜…â˜…â˜…â˜†',
                text: 'ä»Šå¤©çš„ä½ é©åˆé †è‘—æ„Ÿè¦ºèµ°ã€‚ä¸è¦å£“æŠ‘å¿ƒä¸­çš„å°å°æ¸´æœ›ï¼Œç•¶ä½ å‹‡æ•¢æ¸¸å‘å¤§æµ·ï¼Œä½ æœƒç™¼ç¾é©šå–œå°±åœ¨å‰æ–¹ã€‚',
                color: 'çŠç‘šç²‰',
                item: 'æ‰‹ä½œé£¾å“'
            },
            ocean: {
                type: 'Ocean - å¹³éœåŠ›é‡',
                stars: 'â˜…â˜…â˜…â˜…â˜…',
                text: 'åƒå¤§æµ·ä¸€æ¨£åŒ…å®¹æ‰€æœ‰æƒ…ç·’ã€‚ç•¶ä½ å­¸æœƒå¹³éœåœ°çœ‹å¾…é‚£äº›ç…©æƒ±ï¼Œé™½å…‰è‡ªç„¶å°±æœƒé€é€²æ·±æµ·ï¼Œç…§äº®ä½ çš„å¿ƒã€‚',
                color: 'æ·±æµ·è—',
                item: 'é¦™æ°›è Ÿç‡­'
            },
            star: {
                type: 'Star - å¤¢æƒ³æŒ‡å¼•',
                stars: 'â˜…â˜…â˜…â˜…â˜†',
                text: 'ä¸è¦å®³æ€•åšå¤¢ï¼Œä½ çš„å¤¢æƒ³æ­£åƒåŒ—æ¥µæ˜Ÿä¸€æ¨£æŒ‡å¼•è‘—ä½ ã€‚åªè¦å …æŒä½ æ‰€ç›¸ä¿¡çš„ï¼Œæ•´ç‰‡æ˜Ÿç©ºéƒ½æœƒç‚ºä½ é–ƒè€€ã€‚',
                color: 'æ˜Ÿå…‰éŠ€',
                item: 'è¨˜äº‹æœ¬'
            }
        };

        function acceptCall() {
            document.getElementById('calling-screen').classList.add('hidden-state');
            document.getElementById('incall-screen').classList.remove('hidden-state');
            
            bgm.play().catch(e => console.log("BGM æ’­æ”¾å¤±æ•—:", e));
            
            startTimer();
            playDialogueSequentially();
        }

        function startTimer() {
            seconds = 0;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                let min = Math.floor(seconds / 60).toString().padStart(2, '0');
                let sec = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${min}:${sec}`;
            }, 1000);
        }

        // --- æ ¸å¿ƒæ”¹å‹•ï¼šä¸€å€‹ä¸€å€‹æ’­ï¼Œæ’­å®Œæ‰è·³ä¸‹ä¸€å¥ ---
        async function playDialogueSequentially() {
            const box = document.getElementById('dialogue-box');
            
            for (let i = 0; i < dialogueData.length; i++) {
                // å¦‚æœå·²ç¶“æ›æ–·äº†ï¼Œå°±åœæ­¢å¾ªç’°
                if (document.getElementById('incall-screen').classList.contains('hidden-state')) break;

                const item = dialogueData[i];
                box.innerHTML = `<span class="opacity-90">ã€Œ${item.text}ã€</span>`;
                
                // æ’­æ”¾å°æ‡‰æ®µè½çš„èªéŸ³
                currentVoice = new Audio(item.vo);
                
                // å»ºç«‹ä¸€å€‹ Promise ç­‰å¾…èªéŸ³æ’­æ”¾çµæŸ
                await new Promise((resolve) => {
                    currentVoice.onended = resolve; // èªéŸ³çµæŸå¾Œ resolve
                    currentVoice.onerror = resolve; // å‡ºéŒ¯ä¹Ÿ resolve ä»¥å…ç¨‹å¼å¡æ­»
                    currentVoice.play().catch(e => {
                        console.log(`æ’­æ”¾ ${item.vo} å¤±æ•—:`, e);
                        setTimeout(resolve, 2000); // å¤±æ•—çš„è©± 2 ç§’å¾Œè·³ä¸‹ä¸€å¥
                    });
                });

                // èªéŸ³æ’­å®Œå¾Œï¼Œç¨å¾®åœå€‹ 0.5 ç§’å†è·³ä¸‹ä¸€å¥
                await new Promise(r => setTimeout(r, 500));
            }

            // å…¨éƒ¨æ’­å®Œå¾Œé¡¯ç¤ºç¥ç¦æŒ‰éˆ•
            if (!document.getElementById('incall-screen').classList.contains('hidden-state')) {
                document.getElementById('blessing-btn').classList.remove('hidden-state');
            }
        }

        function showBlessing() {
            const box = document.getElementById('dialogue-box');
            box.innerHTML = `<span class="text-blue-100 font-normal leading-loose">${blessing}</span>`;
            document.getElementById('blessing-btn').classList.add('hidden-state');
        }

        function endCall() {
            clearInterval(timerInterval);
            
            // åœæ­¢ç›®å‰æ­£åœ¨æ’­æ”¾çš„åˆ†æ®µèªéŸ³
            if (currentVoice) {
                currentVoice.pause();
                currentVoice.currentTime = 0;
            }

            document.getElementById('incall-screen').classList.add('hidden-state');
            document.getElementById('selection-screen').classList.remove('hidden-state');
        }

        function selectFortune(choice) {
            const data = fortuneData[choice];
            document.getElementById('fortune-type').innerText = data.type;
            document.getElementById('fortune-stars').innerText = data.stars;
            document.getElementById('fortune-text').innerText = data.text;
            document.getElementById('fortune-color').innerText = data.color;
            document.getElementById('fortune-item').innerText = data.item;

            document.getElementById('selection-screen').classList.add('hidden-state');
            document.getElementById('fortune-screen').classList.remove('hidden-state');
        }

        function restartApp() {
            document.getElementById('fortune-screen').classList.add('hidden-state');
            document.getElementById('calling-screen').classList.remove('hidden-state');
            document.getElementById('timer').innerText = "00:00";
            document.getElementById('dialogue-box').innerHTML = "";
            document.getElementById('blessing-btn').classList.add('hidden-state');
            const status = document.querySelector('#calling-screen p');
            status.innerText = "ä¾†é›»ä¸­...";
        }

        function rejectCall() {
            const status = document.querySelector('#calling-screen p');
            status.innerText = "é€šè©±å·²æ‹’çµ•";
            setTimeout(() => {
                status.innerText = "ä¾†é›»ä¸­...";
            }, 2000);
        }
    </script>
</body>
</html>
